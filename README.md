# Детекция людей на видео с использованием YOLOv11

## Описание
Проект реализует детекцию и трекинг людей на видеофайле `crowd.mp4` с использованием модели YOLOv11. Программа выполняет инференс (детекцию объектов) с отрисовкой bounding boxes, отображающих класс (`person`), уверенность (confidence) и (при включённом трекинге) идентификатор трека (ID). Для повышения качества детекции добавлены механизмы сглаживания и сохранения траекторий, что минимизирует мерцание bounding boxes. Код оформлен в стиле git-репозитория, соответствует PEP8, включает docstrings и кросс-платформенную поддержку (Linux, MacOS, Windows).

## Установка
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/mag7231/YOLO11_CrowdDetection.git
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. **Для GPU (CUDA) пользователей**:
   Для ускорения инференса установите `torch` версию с CUDA:
   ```bash
   pip install torch torchvision --index-url https://download.pytorch.org/whl/cu126
   ```
   Проверьте совместимость CUDA на [PyTorch](https://pytorch.org/get-started/locally/). 
   Код автоматически использует GPU, если доступно.

## Зависимости
См. `requirements.txt`:
- ultralytics==8.3.221
- opencv-python==4.12.0.88
- numpy==2.2.6

## Использование
Точка входа — `main.py`. Запуск программы:
```bash
python main.py --input crowd.mp4 --output output.mp4 --confidence 0.4 --use_tracker
```
**Аргументы:**
- `--input`: Путь к входному видео (по умолчанию `crowd.mp4`).
- `--output`: Путь к выходному видео (по умолчанию `output.mp4`).
- `--confidence`: Порог уверенности для детекции (по умолчанию 0.5).
- `--use_tracker`: Включить трекинг с траекториями (флаг).

**Пример вывода**: Программа создаёт `output.mp4` с отрисованными bounding boxes, классом `person`, уверенностью и track ID (если трекинг включён).

## Техническая реализация
Проект использует модель YOLO11n для инференса, так как она обеспечивает оптимальный баланс между скоростью (около 100 мс/кадр на CPU) и качеством детекции. Для минимизации мерцания bounding boxes применён трекинг с сохранением истории треков на 15 кадров, что позволяет предсказывать позиции объектов при временных пропаданиях детекций. Дополнительно реализован механизм сглаживания: если объект не детектируется, используется среднее положение bounding box за последние 15 кадров, сохраняя track ID даже при кратковременных перекрытиях или тряске камеры.

Тестировались YOLO11s и YOLO11m, но они работают в 2 и 3 раза медленнее соответственно, поэтому приоритет отдан скорости инференса при сохранении приемлемого качества.

## Результаты
1. **Код**: `main.py` с полной реализацией.
2. **Видео**: `output.mp4` с bounding boxes, классом `person`, уверенностью и track ID (при трекинге).
3. **Анализ**: Качество детекции высокое благодаря дообучению и трекингу. Средняя уверенность ~0.7-0.95, мерцание минимально за счёт сглаживания и сохранения истории треков. Проблемы: редкие false negatives в сильных скоплениях. Проблему можно решить дообучив модель на качественных данных скоплений людей.

## Возможные улучшения
- Использование YOLO11s/m для повышения точности в сложных сценах.
- Дообучение на большем датасете скоплений людей для эффективной адаптации модели к сценам с перекрытиями.
- Экспорт модели в ONNX для ускорения инференса на CPU или TensorRT для NVIDIA GPU.
- Квантование модели
- Оптимизация для больших видео: batch processing, уменьшение разрешения кадров.
